{% extends "base_staff.html" %}
{% load static %}
{% load bootstrap4 %}
{% load crispy_forms_tags %}

{% block content %}

<div class="">
  <div class="jumbotron">
    <form method="POST" id='inclusionsForm' data-transfers-url="{% url 'SalesApp:ajax_quote_load_transfers' %}"
                                            data-sightseeings-url="{% url 'SalesApp:ajax_quote_load_sightseeings' %}" novalidate>
      {% csrf_token %}
      <h6>Inclusions</h6>
      <hr>
      {{ inclusion_formset.management_form|crispy }}
      {% for form in inclusion_formset %}
          <div class="row">
              <div class="col-2 item_type-class">{{ form.item_type|as_crispy_field }}</div>
              <div class="col col-1 other_type-class">{{ form.other_type|as_crispy_field }}</div>
              <div class="col city-class">{{ form.city|as_crispy_field }}</div>
              <div class="col name-class">{{ form.name|as_crispy_field }}</div>
              <div class="col col-5 details-class">{{ form.details|as_crispy_field }}</div>
              <div class="col transport-class">{{ form.transports|as_crispy_field }}</div>
              <div class="col col-4 transfer-class">{{ form.transfers|as_crispy_field }}</div>
              <div class="col col-4 sightseeing-class">{{ form.sightseeings|as_crispy_field }}</div>
              <div class="col col-4 visa-class">{{ form.visas|as_crispy_field }}</div>
              <div class="col col-4 insurance-class">{{ form.insurance|as_crispy_field }}</div>
              {% if package.type == 'FIXED' %}
                <div class="col-1 optional-class">{{ form.optional|as_crispy_field }}</div>
                <div class="col col-1 include-class">{{ form.include|as_crispy_field }}</div>
              {% endif %}
              {{ form.id }}
              <div class="col-1 DELETE-class">{{ form.DELETE|as_crispy_field }}</div>
          </div>
          <hr>
      {% endfor %}
        <button class="btn btn-primary btn-lg float-right mx-5 px-5" name="redirect" value="True" type="submit">Save</button>
    </form>
  </div>
</div>


<script>
// FORM STYLING SCRIPTS
$("textarea").attr('rows',2)
$("label").css('font-size','0.9em')
</script>

<script>

// THIS SCRIPT INITIALIZES THE FORMS WITH EXISTING DATA
$('.item_type-class select').each(function(){
  $(this).parents('.row').find('.col').hide();

  if ($(this).val() == 'FLIGHT') {
    $(this).parents('.row').find('.details-class').show()
  } else if ($(this).val() == 'TRANSPORT') {
    $(this).parents('.row').find('.transport-class').show();
  } else if ($(this).val() == 'TRANSFER') {
    $(this).parents('.row').find('.transfer-class').show()
  } else if ($(this).val() == 'SIGHTSEEING') {
    $(this).parents('.row').find('.sightseeing-class').show()
  } else if ($(this).val() == 'VISA') {
    $(this).parents('.row').find('.visa-class').show()
  } else if ($(this).val() == 'INSURANCE') {
    $(this).parents('.row').find('.insurance-class').show()
  } else if ($(this).val() == 'OTHER') {
    $(this).parents('.row').find('.city-class').show()
    $(this).parents('.row').find('.other_type-class').show()
    $(this).parents('.row').find('.name-class').show().addClass('col-2')
    $(this).parents('.row').find('.details-class').show().removeClass('col-5').addClass('col-3')
  } else if ($(this).val() == 'EXCLUSION') {
    $(this).parents('.row').find('.optional-class').hide();
    $(this).parents('.row').find('.include-class').hide();
    $(this).parents('.row').find('.details-class').show().addClass('col-4')
  }
});

$('.optional-class input:checkbox').each(function(){
  if ($(this).is(':checked')) {
    $(this).parents('.row').find('.include-class').show();
  }
});

// THIS SCRIPT MODIFIES THE FORM WHEN USER SELECTS ITEM TYPE IN FORM
$('.item_type-class select').change(function(){
  // $(this).parents('.row').find('input').not('[type=hidden]').val("")
  // $(this).parents('.row').find(':checkbox').prop('checked',false);
  // $(this).parents('.row').find('select').not('[id*=item_type]').val("")
  // $(this).parents('.row').find('textarea').val("")
  $(this).parents('.row').find('.col').hide();

  if ($(this).val() == 'FLIGHT') {
    $(this).parents('.row').find('.details-class').show()
  } else if ($(this).val() == 'TRANSPORT') {
    $(this).parents('.row').find('.transport-class').show();
  } else if ($(this).val() == 'TRANSFER') {
    $(this).parents('.row').find('.transfer-class').show()
  } else if ($(this).val() == 'SIGHTSEEING') {
    $(this).parents('.row').find('.sightseeing-class').show()
  } else if ($(this).val() == 'VISA') {
    $(this).parents('.row').find('.visa-class').show()
  } else if ($(this).val() == 'INSURANCE') {
    $(this).parents('.row').find('.insurance-class').show()
  } else if ($(this).val() == 'OTHER') {
    $(this).parents('.row').find('.city-class').show()
    $(this).parents('.row').find('.other_type-class').show()
    $(this).parents('.row').find('.name-class').show().addClass('col-2')
    $(this).parents('.row').find('.details-class').show().removeClass('col-5').addClass('col-3')
  } else if ($(this).val() == 'EXCLUSION') {
    $(this).parents('.row').find('.optional-class').hide();
    $(this).parents('.row').find('.include-class').hide();
    $(this).parents('.row').find('.details-class').show().addClass('col-4')
  }
});

$('.optional-class input:checkbox').change(function(){
  if ($(this).is(':checked')) {
    $(this).parents('.row').find('.include-class').show()
  } else {
    $(this).parents('.row').find('.include-class input:checkbox').prop('checked',false)
    $(this).parents('.row').find('.include-class').hide()
    // $(this).parents('.row').find('.price-class input').val(0)
    // $(this).parents('.row').find('.price-class').hide()
  }
});

</script>

{% endblock %}
