{% extends "base_staff.html" %}
{% load static %}
{% load bootstrap4 %}
{% load widget_tweaks %}
{% load crispy_forms_tags %}
{% load my_extras %}

{% block content %}
<div class="container w-75 p-3">
  <div class="jumbotron">
    <h4 align='center'>Basic Details</h4>
    <hr>
    <br>

    <form method="POST" id="quoteForm" data-cities-url="{% url 'SalesApp:ajax_quote_load_cities' %}" novalidate>
    {% csrf_token %}
    {% if form.errors %}{{form.non_field_errors}}{% endif %}
    <div class="row justify-content-center">
      <div class="col-md-6">
        <div class="card">
          <div class="card-body">
            {{ form.lead|as_crispy_field }}
            {{ form.title|as_crispy_field }}
            {{ form.starting_place|as_crispy_field }}
            {{ form.adults|as_crispy_field }}
            {{ form.children|as_crispy_field }}
            {{ form.children_age|as_crispy_field }}
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card">
          <div class="card-body">
            {{ form.start_date|as_crispy_field }}
            {{ form.end_date|as_crispy_field }}
            {{ form.destinations|as_crispy_field }}
            {{ form.cities|as_crispy_field }}
          </div>
        </div>
      </div>
    </div>
    <br>
    <div class="card">
      <div class="card-body">
        <div class="row">
          <div class="col">{{ form.mark_up|as_crispy_field }}</div>
          <div class="col">{{ form.discount|as_crispy_field }}</div>
          <div class="col">{{ form.price|as_crispy_field }}</div>
          {% comment %}<div class="col align-self-center"><button class="btn btn-primary float-right" type="button" id="price-button">Get Price</button></div>{% endcomment %}
        </div>
      </div>
    </div>
    <br>
    <button class="btn btn-primary btn-lg float-right mx-5 px-5" name="redirect" value="True" type="submit">Save</button>
  </form>
  </div>
</div>

<script>
// SCRIPT FOR RENDERING CHILDREN AGE FIELDS
$('input[name*=children_age]').after("<small class='form-text text-muted'>Enter age of all children separated by commas as show above.</small>");;
$('input[name*=children_age]').attr('placeholder','0,9,12')

// SCRIPT FOR VARYING CITY SELECTION IN QUOTE INFO BASED ON DESTINATIONS SELECTED
$("#id_destinations").change(function () {
  var url = $("#quoteForm").attr("data-cities-url");  // get the url of the `quote_load_cities` view
  var destination_ids = $(this).val();  // get the selected country ID from the HTML input

  $.ajax({                       // initialize an AJAX request
    url: url,                    // set the url of the request (= localhost:8000/sales/ajax/quote/load-cities/)
    data: {
      'destinations': destination_ids       // add the destination id to the GET parameters
    },
    success: function (data) {   // `data` is the return of the `load_cities` view function
      $("#id_cities").html(data);  // replace the contents of the city input with the data that came from the server
    }
  });
});
</script>


{% endblock %}
